float quatNew[4][1];
quatNew[0] = q0 - (dax*dt*q1)/2 - (day*dt*q2)/2 - (daz*dt*q3)/2;
quatNew[1] = q1 + (dax*dt*q0)/2 - (day*dt*q3)/2 + (daz*dt*q2)/2;
quatNew[2] = q2 + (dax*dt*q3)/2 + (day*dt*q0)/2 - (daz*dt*q1)/2;
quatNew[3] = q3 - (dax*dt*q2)/2 + (day*dt*q1)/2 + (daz*dt*q0)/2;
float SF[3][1];
SF[0] = (day*dt)/2;
SF[1] = (daz*dt)/2;
SF[2] = (dax*dt)/2;
float Pk_k1[4][4];
Pk_k1[0][0] = Pk[0][0] + Q[0][0] - Pk[1][0]*SF[2] - Pk[2][0]*SF[0] - Pk[3][0]*SF[1] + SF[2]*(Pk[1][1]*SF[2] - Pk[0][1] + Pk[2][1]*SF[0] + Pk[3][1]*SF[1]) + SF[0]*(Pk[1][2]*SF[2] - Pk[0][2] + Pk[2][2]*SF[0] + Pk[3][2]*SF[1]) + SF[1]*(Pk[1][3]*SF[2] - Pk[0][3] + Pk[2][3]*SF[0] + Pk[3][3]*SF[1]);
Pk_k1[0][1] = Pk[0][1] + Q[0][1] - Pk[1][1]*SF[2] - Pk[2][1]*SF[0] - Pk[3][1]*SF[1] - SF[2]*(Pk[1][0]*SF[2] - Pk[0][0] + Pk[2][0]*SF[0] + Pk[3][0]*SF[1]) - SF[1]*(Pk[1][2]*SF[2] - Pk[0][2] + Pk[2][2]*SF[0] + Pk[3][2]*SF[1]) + SF[0]*(Pk[1][3]*SF[2] - Pk[0][3] + Pk[2][3]*SF[0] + Pk[3][3]*SF[1]);
Pk_k1[0][2] = Pk[0][2] + Q[0][2] - Pk[1][2]*SF[2] - Pk[2][2]*SF[0] - Pk[3][2]*SF[1] - SF[0]*(Pk[1][0]*SF[2] - Pk[0][0] + Pk[2][0]*SF[0] + Pk[3][0]*SF[1]) + SF[1]*(Pk[1][1]*SF[2] - Pk[0][1] + Pk[2][1]*SF[0] + Pk[3][1]*SF[1]) - SF[2]*(Pk[1][3]*SF[2] - Pk[0][3] + Pk[2][3]*SF[0] + Pk[3][3]*SF[1]);
Pk_k1[0][3] = Pk[0][3] + Q[0][3] - Pk[1][3]*SF[2] - Pk[2][3]*SF[0] - Pk[3][3]*SF[1] - SF[1]*(Pk[1][0]*SF[2] - Pk[0][0] + Pk[2][0]*SF[0] + Pk[3][0]*SF[1]) - SF[0]*(Pk[1][1]*SF[2] - Pk[0][1] + Pk[2][1]*SF[0] + Pk[3][1]*SF[1]) + SF[2]*(Pk[1][2]*SF[2] - Pk[0][2] + Pk[2][2]*SF[0] + Pk[3][2]*SF[1]);
Pk_k1[1][0] = Pk[1][0] + Q[1][0] + Pk[0][0]*SF[2] + Pk[2][0]*SF[1] - Pk[3][0]*SF[0] - SF[2]*(Pk[1][1] + Pk[0][1]*SF[2] + Pk[2][1]*SF[1] - Pk[3][1]*SF[0]) - SF[0]*(Pk[1][2] + Pk[0][2]*SF[2] + Pk[2][2]*SF[1] - Pk[3][2]*SF[0]) - SF[1]*(Pk[1][3] + Pk[0][3]*SF[2] + Pk[2][3]*SF[1] - Pk[3][3]*SF[0]);
Pk_k1[1][1] = Pk[1][1] + Q[1][1] + Pk[0][1]*SF[2] + Pk[2][1]*SF[1] - Pk[3][1]*SF[0] + SF[2]*(Pk[1][0] + Pk[0][0]*SF[2] + Pk[2][0]*SF[1] - Pk[3][0]*SF[0]) + SF[1]*(Pk[1][2] + Pk[0][2]*SF[2] + Pk[2][2]*SF[1] - Pk[3][2]*SF[0]) - SF[0]*(Pk[1][3] + Pk[0][3]*SF[2] + Pk[2][3]*SF[1] - Pk[3][3]*SF[0]);
Pk_k1[1][2] = Pk[1][2] + Q[1][2] + Pk[0][2]*SF[2] + Pk[2][2]*SF[1] - Pk[3][2]*SF[0] + SF[0]*(Pk[1][0] + Pk[0][0]*SF[2] + Pk[2][0]*SF[1] - Pk[3][0]*SF[0]) - SF[1]*(Pk[1][1] + Pk[0][1]*SF[2] + Pk[2][1]*SF[1] - Pk[3][1]*SF[0]) + SF[2]*(Pk[1][3] + Pk[0][3]*SF[2] + Pk[2][3]*SF[1] - Pk[3][3]*SF[0]);
Pk_k1[1][3] = Pk[1][3] + Q[1][3] + Pk[0][3]*SF[2] + Pk[2][3]*SF[1] - Pk[3][3]*SF[0] + SF[1]*(Pk[1][0] + Pk[0][0]*SF[2] + Pk[2][0]*SF[1] - Pk[3][0]*SF[0]) + SF[0]*(Pk[1][1] + Pk[0][1]*SF[2] + Pk[2][1]*SF[1] - Pk[3][1]*SF[0]) - SF[2]*(Pk[1][2] + Pk[0][2]*SF[2] + Pk[2][2]*SF[1] - Pk[3][2]*SF[0]);
Pk_k1[2][0] = Pk[2][0] + Q[2][0] + Pk[0][0]*SF[0] - Pk[1][0]*SF[1] + Pk[3][0]*SF[2] - SF[2]*(Pk[2][1] + Pk[0][1]*SF[0] - Pk[1][1]*SF[1] + Pk[3][1]*SF[2]) - SF[0]*(Pk[2][2] + Pk[0][2]*SF[0] - Pk[1][2]*SF[1] + Pk[3][2]*SF[2]) - SF[1]*(Pk[2][3] + Pk[0][3]*SF[0] - Pk[1][3]*SF[1] + Pk[3][3]*SF[2]);
Pk_k1[2][1] = Pk[2][1] + Q[2][1] + Pk[0][1]*SF[0] - Pk[1][1]*SF[1] + Pk[3][1]*SF[2] + SF[2]*(Pk[2][0] + Pk[0][0]*SF[0] - Pk[1][0]*SF[1] + Pk[3][0]*SF[2]) + SF[1]*(Pk[2][2] + Pk[0][2]*SF[0] - Pk[1][2]*SF[1] + Pk[3][2]*SF[2]) - SF[0]*(Pk[2][3] + Pk[0][3]*SF[0] - Pk[1][3]*SF[1] + Pk[3][3]*SF[2]);
Pk_k1[2][2] = Pk[2][2] + Q[2][2] + Pk[0][2]*SF[0] - Pk[1][2]*SF[1] + Pk[3][2]*SF[2] + SF[0]*(Pk[2][0] + Pk[0][0]*SF[0] - Pk[1][0]*SF[1] + Pk[3][0]*SF[2]) - SF[1]*(Pk[2][1] + Pk[0][1]*SF[0] - Pk[1][1]*SF[1] + Pk[3][1]*SF[2]) + SF[2]*(Pk[2][3] + Pk[0][3]*SF[0] - Pk[1][3]*SF[1] + Pk[3][3]*SF[2]);
Pk_k1[2][3] = Pk[2][3] + Q[2][3] + Pk[0][3]*SF[0] - Pk[1][3]*SF[1] + Pk[3][3]*SF[2] + SF[1]*(Pk[2][0] + Pk[0][0]*SF[0] - Pk[1][0]*SF[1] + Pk[3][0]*SF[2]) + SF[0]*(Pk[2][1] + Pk[0][1]*SF[0] - Pk[1][1]*SF[1] + Pk[3][1]*SF[2]) - SF[2]*(Pk[2][2] + Pk[0][2]*SF[0] - Pk[1][2]*SF[1] + Pk[3][2]*SF[2]);
Pk_k1[3][0] = Pk[3][0] + Q[3][0] + Pk[0][0]*SF[1] + Pk[1][0]*SF[0] - Pk[2][0]*SF[2] - SF[2]*(Pk[3][1] + Pk[0][1]*SF[1] + Pk[1][1]*SF[0] - Pk[2][1]*SF[2]) - SF[0]*(Pk[3][2] + Pk[0][2]*SF[1] + Pk[1][2]*SF[0] - Pk[2][2]*SF[2]) - SF[1]*(Pk[3][3] + Pk[0][3]*SF[1] + Pk[1][3]*SF[0] - Pk[2][3]*SF[2]);
Pk_k1[3][1] = Pk[3][1] + Q[3][1] + Pk[0][1]*SF[1] + Pk[1][1]*SF[0] - Pk[2][1]*SF[2] + SF[2]*(Pk[3][0] + Pk[0][0]*SF[1] + Pk[1][0]*SF[0] - Pk[2][0]*SF[2]) + SF[1]*(Pk[3][2] + Pk[0][2]*SF[1] + Pk[1][2]*SF[0] - Pk[2][2]*SF[2]) - SF[0]*(Pk[3][3] + Pk[0][3]*SF[1] + Pk[1][3]*SF[0] - Pk[2][3]*SF[2]);
Pk_k1[3][2] = Pk[3][2] + Q[3][2] + Pk[0][2]*SF[1] + Pk[1][2]*SF[0] - Pk[2][2]*SF[2] + SF[0]*(Pk[3][0] + Pk[0][0]*SF[1] + Pk[1][0]*SF[0] - Pk[2][0]*SF[2]) - SF[1]*(Pk[3][1] + Pk[0][1]*SF[1] + Pk[1][1]*SF[0] - Pk[2][1]*SF[2]) + SF[2]*(Pk[3][3] + Pk[0][3]*SF[1] + Pk[1][3]*SF[0] - Pk[2][3]*SF[2]);
Pk_k1[3][3] = Pk[3][3] + Q[3][3] + Pk[0][3]*SF[1] + Pk[1][3]*SF[0] - Pk[2][3]*SF[2] + SF[1]*(Pk[3][0] + Pk[0][0]*SF[1] + Pk[1][0]*SF[0] - Pk[2][0]*SF[2]) + SF[0]*(Pk[3][1] + Pk[0][1]*SF[1] + Pk[1][1]*SF[0] - Pk[2][1]*SF[2]) - SF[2]*(Pk[3][2] + Pk[0][2]*SF[1] + Pk[1][2]*SF[0] - Pk[2][2]*SF[2]);
float Hk1[3][4];
Hk1[0][0] = -2*g*q2;
Hk1[0][1] = 2*g*q3;
Hk1[0][2] = -2*g*q0;
Hk1[0][3] = 2*g*q1;
Hk1[1][0] = 2*g*q1;
Hk1[1][1] = 2*g*q0;
Hk1[1][2] = 2*g*q3;
Hk1[1][3] = 2*g*q2;
Hk1[2][0] = 2*g*q0;
Hk1[2][1] = -2*g*q1;
Hk1[2][2] = -2*g*q2;
Hk1[2][3] = 2*g*q3;
float SK_dVelX[1][1];
SK_dVelX[0] = 1/(R_dVel + 2*g*q2*(2*Pk_k1[0][0]*g*q2 - 2*Pk_k1[1][0]*g*q3 + 2*Pk_k1[2][0]*g*q0 - 2*Pk_k1[3][0]*g*q1) - 2*g*q3*(2*Pk_k1[0][1]*g*q2 - 2*Pk_k1[1][1]*g*q3 + 2*Pk_k1[2][1]*g*q0 - 2*Pk_k1[3][1]*g*q1) + 2*g*q0*(2*Pk_k1[0][2]*g*q2 - 2*Pk_k1[1][2]*g*q3 + 2*Pk_k1[2][2]*g*q0 - 2*Pk_k1[3][2]*g*q1) - 2*g*q1*(2*Pk_k1[0][3]*g*q2 - 2*Pk_k1[1][3]*g*q3 + 2*Pk_k1[2][3]*g*q0 - 2*Pk_k1[3][3]*g*q1));
float SK_dVelY[1][1];
SK_dVelY[0] = 1/(R_dVel + 2*g*q1*(2*Pk_k1[0][0]*g*q1 + 2*Pk_k1[1][0]*g*q0 + 2*Pk_k1[2][0]*g*q3 + 2*Pk_k1[3][0]*g*q2) + 2*g*q0*(2*Pk_k1[0][1]*g*q1 + 2*Pk_k1[1][1]*g*q0 + 2*Pk_k1[2][1]*g*q3 + 2*Pk_k1[3][1]*g*q2) + 2*g*q3*(2*Pk_k1[0][2]*g*q1 + 2*Pk_k1[1][2]*g*q0 + 2*Pk_k1[2][2]*g*q3 + 2*Pk_k1[3][2]*g*q2) + 2*g*q2*(2*Pk_k1[0][3]*g*q1 + 2*Pk_k1[1][3]*g*q0 + 2*Pk_k1[2][3]*g*q3 + 2*Pk_k1[3][3]*g*q2));
float SK_dVelZ[1][1];
SK_dVelZ[0] = 1/(R_dVel + 2*g*q0*(2*Pk_k1[0][0]*g*q0 - 2*Pk_k1[1][0]*g*q1 - 2*Pk_k1[2][0]*g*q2 + 2*Pk_k1[3][0]*g*q3) - 2*g*q1*(2*Pk_k1[0][1]*g*q0 - 2*Pk_k1[1][1]*g*q1 - 2*Pk_k1[2][1]*g*q2 + 2*Pk_k1[3][1]*g*q3) - 2*g*q2*(2*Pk_k1[0][2]*g*q0 - 2*Pk_k1[1][2]*g*q1 - 2*Pk_k1[2][2]*g*q2 + 2*Pk_k1[3][2]*g*q3) + 2*g*q3*(2*Pk_k1[0][3]*g*q0 - 2*Pk_k1[1][3]*g*q1 - 2*Pk_k1[2][3]*g*q2 + 2*Pk_k1[3][3]*g*q3));
float Kk1[4][3];
Kk1[0][0] = -SK_dVelX[0]*(2*Pk_k1[0][0]*g*q2 + 2*Pk_k1[0][2]*g*q0 - 2*Pk_k1[0][1]*g*q3 - 2*Pk_k1[0][3]*g*q1);
Kk1[0][1] = SK_dVelY[0]*(2*Pk_k1[0][0]*g*q1 + 2*Pk_k1[0][1]*g*q0 + 2*Pk_k1[0][2]*g*q3 + 2*Pk_k1[0][3]*g*q2);
Kk1[0][2] = SK_dVelZ[0]*(2*Pk_k1[0][0]*g*q0 - 2*Pk_k1[0][1]*g*q1 - 2*Pk_k1[0][2]*g*q2 + 2*Pk_k1[0][3]*g*q3);
Kk1[1][0] = -SK_dVelX[0]*(2*Pk_k1[1][0]*g*q2 + 2*Pk_k1[1][2]*g*q0 - 2*Pk_k1[1][1]*g*q3 - 2*Pk_k1[1][3]*g*q1);
Kk1[1][1] = SK_dVelY[0]*(2*Pk_k1[1][0]*g*q1 + 2*Pk_k1[1][1]*g*q0 + 2*Pk_k1[1][2]*g*q3 + 2*Pk_k1[1][3]*g*q2);
Kk1[1][2] = SK_dVelZ[0]*(2*Pk_k1[1][0]*g*q0 - 2*Pk_k1[1][1]*g*q1 - 2*Pk_k1[1][2]*g*q2 + 2*Pk_k1[1][3]*g*q3);
Kk1[2][0] = -SK_dVelX[0]*(2*Pk_k1[2][0]*g*q2 + 2*Pk_k1[2][2]*g*q0 - 2*Pk_k1[2][1]*g*q3 - 2*Pk_k1[2][3]*g*q1);
Kk1[2][1] = SK_dVelY[0]*(2*Pk_k1[2][0]*g*q1 + 2*Pk_k1[2][1]*g*q0 + 2*Pk_k1[2][2]*g*q3 + 2*Pk_k1[2][3]*g*q2);
Kk1[2][2] = SK_dVelZ[0]*(2*Pk_k1[2][0]*g*q0 - 2*Pk_k1[2][1]*g*q1 - 2*Pk_k1[2][2]*g*q2 + 2*Pk_k1[2][3]*g*q3);
Kk1[3][0] = -SK_dVelX[0]*(2*Pk_k1[3][0]*g*q2 + 2*Pk_k1[3][2]*g*q0 - 2*Pk_k1[3][1]*g*q3 - 2*Pk_k1[3][3]*g*q1);
Kk1[3][1] = SK_dVelY[0]*(2*Pk_k1[3][0]*g*q1 + 2*Pk_k1[3][1]*g*q0 + 2*Pk_k1[3][2]*g*q3 + 2*Pk_k1[3][3]*g*q2);
Kk1[3][2] = SK_dVelZ[0]*(2*Pk_k1[3][0]*g*q0 - 2*Pk_k1[3][1]*g*q1 - 2*Pk_k1[3][2]*g*q2 + 2*Pk_k1[3][3]*g*q3);
float hk1[3][1];
hk1[0] = -g*(2*q0*q2 - 2*q1*q3);
hk1[1] = g*(2*q0*q1 + 2*q2*q3);
hk1[2] = g*(q0*q0 - q1*q1 - q2*q2 + q3*q3);
float Sqc1[3][1];
Sqc1[0] = dvz - hk1[2][0];
Sqc1[1] = dvy - hk1[1][0];
Sqc1[2] = dvx - hk1[0][0];
float qc1[4][1];
qc1[0] = Kk1[0][0]*Sqc1[2] + Kk1[0][1]*Sqc1[1] + Kk1[0][2]*Sqc1[0];
qc1[1] = Kk1[1][0]*Sqc1[2] + Kk1[1][1]*Sqc1[1] + Kk1[1][2]*Sqc1[0];
qc1[2] = Kk1[2][0]*Sqc1[2] + Kk1[2][1]*Sqc1[1] + Kk1[2][2]*Sqc1[0];
qc1[3] = Kk1[3][0]*Sqc1[2] + Kk1[3][1]*Sqc1[1] + Kk1[3][2]*Sqc1[0];
float SPk1[16][1];
SPk1[0] = Hk1[0][3]*Kk1[3][0] + Hk1[1][3]*Kk1[3][1] + Hk1[2][3]*Kk1[3][2];
SPk1[1] = Hk1[0][2]*Kk1[3][0] + Hk1[1][2]*Kk1[3][1] + Hk1[2][2]*Kk1[3][2];
SPk1[2] = Hk1[0][1]*Kk1[3][0] + Hk1[1][1]*Kk1[3][1] + Hk1[2][1]*Kk1[3][2];
SPk1[3] = Hk1[0][0]*Kk1[3][0] + Hk1[1][0]*Kk1[3][1] + Hk1[2][0]*Kk1[3][2];
SPk1[4] = Hk1[0][3]*Kk1[2][0] + Hk1[1][3]*Kk1[2][1] + Hk1[2][3]*Kk1[2][2];
SPk1[5] = Hk1[0][2]*Kk1[2][0] + Hk1[1][2]*Kk1[2][1] + Hk1[2][2]*Kk1[2][2];
SPk1[6] = Hk1[0][1]*Kk1[2][0] + Hk1[1][1]*Kk1[2][1] + Hk1[2][1]*Kk1[2][2];
SPk1[7] = Hk1[0][0]*Kk1[2][0] + Hk1[1][0]*Kk1[2][1] + Hk1[2][0]*Kk1[2][2];
SPk1[8] = Hk1[0][3]*Kk1[1][0] + Hk1[1][3]*Kk1[1][1] + Hk1[2][3]*Kk1[1][2];
SPk1[9] = Hk1[0][2]*Kk1[1][0] + Hk1[1][2]*Kk1[1][1] + Hk1[2][2]*Kk1[1][2];
SPk1[10] = Hk1[0][1]*Kk1[1][0] + Hk1[1][1]*Kk1[1][1] + Hk1[2][1]*Kk1[1][2];
SPk1[11] = Hk1[0][0]*Kk1[1][0] + Hk1[1][0]*Kk1[1][1] + Hk1[2][0]*Kk1[1][2];
SPk1[12] = Hk1[0][3]*Kk1[0][0] + Hk1[1][3]*Kk1[0][1] + Hk1[2][3]*Kk1[0][2];
SPk1[13] = Hk1[0][2]*Kk1[0][0] + Hk1[1][2]*Kk1[0][1] + Hk1[2][2]*Kk1[0][2];
SPk1[14] = Hk1[0][1]*Kk1[0][0] + Hk1[1][1]*Kk1[0][1] + Hk1[2][1]*Kk1[0][2];
SPk1[15] = Hk1[0][0]*Kk1[0][0] + Hk1[1][0]*Kk1[0][1] + Hk1[2][0]*Kk1[0][2];
float Pk1[4][4];
Pk1[0][0] = Pk_k1[0][0] - Pk_k1[0][0]*SPk1[15] - Pk_k1[1][0]*SPk1[14] - Pk_k1[2][0]*SPk1[13] - Pk_k1[3][0]*SPk1[12];
Pk1[0][1] = Pk_k1[0][1] - Pk_k1[0][1]*SPk1[15] - Pk_k1[1][1]*SPk1[14] - Pk_k1[2][1]*SPk1[13] - Pk_k1[3][1]*SPk1[12];
Pk1[0][2] = Pk_k1[0][2] - Pk_k1[0][2]*SPk1[15] - Pk_k1[1][2]*SPk1[14] - Pk_k1[2][2]*SPk1[13] - Pk_k1[3][2]*SPk1[12];
Pk1[0][3] = Pk_k1[0][3] - Pk_k1[0][3]*SPk1[15] - Pk_k1[1][3]*SPk1[14] - Pk_k1[2][3]*SPk1[13] - Pk_k1[3][3]*SPk1[12];
Pk1[1][0] = Pk_k1[1][0] - Pk_k1[0][0]*SPk1[11] - Pk_k1[1][0]*SPk1[10] - Pk_k1[2][0]*SPk1[9] - Pk_k1[3][0]*SPk1[8];
Pk1[1][1] = Pk_k1[1][1] - Pk_k1[0][1]*SPk1[11] - Pk_k1[1][1]*SPk1[10] - Pk_k1[2][1]*SPk1[9] - Pk_k1[3][1]*SPk1[8];
Pk1[1][2] = Pk_k1[1][2] - Pk_k1[0][2]*SPk1[11] - Pk_k1[1][2]*SPk1[10] - Pk_k1[2][2]*SPk1[9] - Pk_k1[3][2]*SPk1[8];
Pk1[1][3] = Pk_k1[1][3] - Pk_k1[0][3]*SPk1[11] - Pk_k1[1][3]*SPk1[10] - Pk_k1[2][3]*SPk1[9] - Pk_k1[3][3]*SPk1[8];
Pk1[2][0] = Pk_k1[2][0] - Pk_k1[0][0]*SPk1[7] - Pk_k1[1][0]*SPk1[6] - Pk_k1[2][0]*SPk1[5] - Pk_k1[3][0]*SPk1[4];
Pk1[2][1] = Pk_k1[2][1] - Pk_k1[0][1]*SPk1[7] - Pk_k1[1][1]*SPk1[6] - Pk_k1[2][1]*SPk1[5] - Pk_k1[3][1]*SPk1[4];
Pk1[2][2] = Pk_k1[2][2] - Pk_k1[0][2]*SPk1[7] - Pk_k1[1][2]*SPk1[6] - Pk_k1[2][2]*SPk1[5] - Pk_k1[3][2]*SPk1[4];
Pk1[2][3] = Pk_k1[2][3] - Pk_k1[0][3]*SPk1[7] - Pk_k1[1][3]*SPk1[6] - Pk_k1[2][3]*SPk1[5] - Pk_k1[3][3]*SPk1[4];
Pk1[3][0] = Pk_k1[3][0] - Pk_k1[0][0]*SPk1[3] - Pk_k1[1][0]*SPk1[2] - Pk_k1[2][0]*SPk1[1] - Pk_k1[3][0]*SPk1[0];
Pk1[3][1] = Pk_k1[3][1] - Pk_k1[0][1]*SPk1[3] - Pk_k1[1][1]*SPk1[2] - Pk_k1[2][1]*SPk1[1] - Pk_k1[3][1]*SPk1[0];
Pk1[3][2] = Pk_k1[3][2] - Pk_k1[0][2]*SPk1[3] - Pk_k1[1][2]*SPk1[2] - Pk_k1[2][2]*SPk1[1] - Pk_k1[3][2]*SPk1[0];
Pk1[3][3] = Pk_k1[3][3] - Pk_k1[0][3]*SPk1[3] - Pk_k1[1][3]*SPk1[2] - Pk_k1[2][3]*SPk1[1] - Pk_k1[3][3]*SPk1[0];
float Hk2[3][4];
Hk2[0][0] = 2*q0;
Hk2[0][1] = 2*q1;
Hk2[0][2] = -2*q2;
Hk2[0][3] = -2*q3;
Hk2[1][0] = -2*q3;
Hk2[1][1] = 2*q2;
Hk2[1][2] = 2*q1;
Hk2[1][3] = -2*q0;
Hk2[2][0] = 2*q2;
Hk2[2][1] = 2*q3;
Hk2[2][2] = 2*q0;
Hk2[2][3] = 2*q1;
float SK_MagX[1][1];
SK_MagX[0] = 1/(R_Mag + 2*q0*(2*Pk_k1[0][0]*q0 + 2*Pk_k1[1][0]*q1 - 2*Pk_k1[2][0]*q2 - 2*Pk_k1[3][0]*q3) + 2*q1*(2*Pk_k1[0][1]*q0 + 2*Pk_k1[1][1]*q1 - 2*Pk_k1[2][1]*q2 - 2*Pk_k1[3][1]*q3) - 2*q2*(2*Pk_k1[0][2]*q0 + 2*Pk_k1[1][2]*q1 - 2*Pk_k1[2][2]*q2 - 2*Pk_k1[3][2]*q3) - 2*q3*(2*Pk_k1[0][3]*q0 + 2*Pk_k1[1][3]*q1 - 2*Pk_k1[2][3]*q2 - 2*Pk_k1[3][3]*q3));
float SK_MagY[1][1];
SK_MagY[0] = 1/(R_Mag + 2*q3*(2*Pk_k1[0][0]*q3 - 2*Pk_k1[1][0]*q2 - 2*Pk_k1[2][0]*q1 + 2*Pk_k1[3][0]*q0) - 2*q2*(2*Pk_k1[0][1]*q3 - 2*Pk_k1[1][1]*q2 - 2*Pk_k1[2][1]*q1 + 2*Pk_k1[3][1]*q0) - 2*q1*(2*Pk_k1[0][2]*q3 - 2*Pk_k1[1][2]*q2 - 2*Pk_k1[2][2]*q1 + 2*Pk_k1[3][2]*q0) + 2*q0*(2*Pk_k1[0][3]*q3 - 2*Pk_k1[1][3]*q2 - 2*Pk_k1[2][3]*q1 + 2*Pk_k1[3][3]*q0));
float SK_MagZ[1][1];
SK_MagZ[0] = 1/(R_Mag + 2*q2*(2*Pk_k1[0][0]*q2 + 2*Pk_k1[1][0]*q3 + 2*Pk_k1[2][0]*q0 + 2*Pk_k1[3][0]*q1) + 2*q3*(2*Pk_k1[0][1]*q2 + 2*Pk_k1[1][1]*q3 + 2*Pk_k1[2][1]*q0 + 2*Pk_k1[3][1]*q1) + 2*q0*(2*Pk_k1[0][2]*q2 + 2*Pk_k1[1][2]*q3 + 2*Pk_k1[2][2]*q0 + 2*Pk_k1[3][2]*q1) + 2*q1*(2*Pk_k1[0][3]*q2 + 2*Pk_k1[1][3]*q3 + 2*Pk_k1[2][3]*q0 + 2*Pk_k1[3][3]*q1));
float Kk2[4][3];
Kk2[0][0] = SK_MagX[0]*(2*Pk_k1[0][0]*q0 + 2*Pk_k1[0][1]*q1 - 2*Pk_k1[0][2]*q2 - 2*Pk_k1[0][3]*q3);
Kk2[0][1] = -SK_MagY[0]*(2*Pk_k1[0][0]*q3 - 2*Pk_k1[0][1]*q2 - 2*Pk_k1[0][2]*q1 + 2*Pk_k1[0][3]*q0);
Kk2[0][2] = SK_MagZ[0]*(2*Pk_k1[0][0]*q2 + 2*Pk_k1[0][2]*q0 + 2*Pk_k1[0][1]*q3 + 2*Pk_k1[0][3]*q1);
Kk2[1][0] = SK_MagX[0]*(2*Pk_k1[1][0]*q0 + 2*Pk_k1[1][1]*q1 - 2*Pk_k1[1][2]*q2 - 2*Pk_k1[1][3]*q3);
Kk2[1][1] = -SK_MagY[0]*(2*Pk_k1[1][0]*q3 - 2*Pk_k1[1][1]*q2 - 2*Pk_k1[1][2]*q1 + 2*Pk_k1[1][3]*q0);
Kk2[1][2] = SK_MagZ[0]*(2*Pk_k1[1][0]*q2 + 2*Pk_k1[1][2]*q0 + 2*Pk_k1[1][1]*q3 + 2*Pk_k1[1][3]*q1);
Kk2[2][0] = SK_MagX[0]*(2*Pk_k1[2][0]*q0 + 2*Pk_k1[2][1]*q1 - 2*Pk_k1[2][2]*q2 - 2*Pk_k1[2][3]*q3);
Kk2[2][1] = -SK_MagY[0]*(2*Pk_k1[2][0]*q3 - 2*Pk_k1[2][1]*q2 - 2*Pk_k1[2][2]*q1 + 2*Pk_k1[2][3]*q0);
Kk2[2][2] = SK_MagZ[0]*(2*Pk_k1[2][0]*q2 + 2*Pk_k1[2][2]*q0 + 2*Pk_k1[2][1]*q3 + 2*Pk_k1[2][3]*q1);
Kk2[3][0] = SK_MagX[0]*(2*Pk_k1[3][0]*q0 + 2*Pk_k1[3][1]*q1 - 2*Pk_k1[3][2]*q2 - 2*Pk_k1[3][3]*q3);
Kk2[3][1] = -SK_MagY[0]*(2*Pk_k1[3][0]*q3 - 2*Pk_k1[3][1]*q2 - 2*Pk_k1[3][2]*q1 + 2*Pk_k1[3][3]*q0);
Kk2[3][2] = SK_MagZ[0]*(2*Pk_k1[3][0]*q2 + 2*Pk_k1[3][2]*q0 + 2*Pk_k1[3][1]*q3 + 2*Pk_k1[3][3]*q1);
float hk2[3][1];
hk2[0] = q0*q0 + q1*q1 - q2*q2 - q3*q3;
hk2[1] = 2*q1*q2 - 2*q0*q3;
hk2[2] = 2*q0*q2 + 2*q1*q3;
float Sqc2[3][1];
Sqc2[0] = hk2[2][0] - magZ;
Sqc2[1] = hk2[1][0] - magY;
Sqc2[2] = hk2[0][0] - magX;
float qc2[4][1];
qc2[0] = - Kk2[0][0]*Sqc2[2] - Kk2[0][1]*Sqc2[1] - Kk2[0][2]*Sqc2[0];
qc2[1] = - Kk2[1][0]*Sqc2[2] - Kk2[1][1]*Sqc2[1] - Kk2[1][2]*Sqc2[0];
qc2[2] = - Kk2[2][0]*Sqc2[2] - Kk2[2][1]*Sqc2[1] - Kk2[2][2]*Sqc2[0];
qc2[3] = - Kk2[3][0]*Sqc2[2] - Kk2[3][1]*Sqc2[1] - Kk2[3][2]*Sqc2[0];
float SPk2[16][1];
SPk2[0] = Hk2[0][3]*Kk2[3][0] + Hk2[1][3]*Kk2[3][1] + Hk2[2][3]*Kk2[3][2];
SPk2[1] = Hk2[0][2]*Kk2[3][0] + Hk2[1][2]*Kk2[3][1] + Hk2[2][2]*Kk2[3][2];
SPk2[2] = Hk2[0][1]*Kk2[3][0] + Hk2[1][1]*Kk2[3][1] + Hk2[2][1]*Kk2[3][2];
SPk2[3] = Hk2[0][0]*Kk2[3][0] + Hk2[1][0]*Kk2[3][1] + Hk2[2][0]*Kk2[3][2];
SPk2[4] = Hk2[0][3]*Kk2[2][0] + Hk2[1][3]*Kk2[2][1] + Hk2[2][3]*Kk2[2][2];
SPk2[5] = Hk2[0][2]*Kk2[2][0] + Hk2[1][2]*Kk2[2][1] + Hk2[2][2]*Kk2[2][2];
SPk2[6] = Hk2[0][1]*Kk2[2][0] + Hk2[1][1]*Kk2[2][1] + Hk2[2][1]*Kk2[2][2];
SPk2[7] = Hk2[0][0]*Kk2[2][0] + Hk2[1][0]*Kk2[2][1] + Hk2[2][0]*Kk2[2][2];
SPk2[8] = Hk2[0][3]*Kk2[1][0] + Hk2[1][3]*Kk2[1][1] + Hk2[2][3]*Kk2[1][2];
SPk2[9] = Hk2[0][2]*Kk2[1][0] + Hk2[1][2]*Kk2[1][1] + Hk2[2][2]*Kk2[1][2];
SPk2[10] = Hk2[0][1]*Kk2[1][0] + Hk2[1][1]*Kk2[1][1] + Hk2[2][1]*Kk2[1][2];
SPk2[11] = Hk2[0][0]*Kk2[1][0] + Hk2[1][0]*Kk2[1][1] + Hk2[2][0]*Kk2[1][2];
SPk2[12] = Hk2[0][3]*Kk2[0][0] + Hk2[1][3]*Kk2[0][1] + Hk2[2][3]*Kk2[0][2];
SPk2[13] = Hk2[0][2]*Kk2[0][0] + Hk2[1][2]*Kk2[0][1] + Hk2[2][2]*Kk2[0][2];
SPk2[14] = Hk2[0][1]*Kk2[0][0] + Hk2[1][1]*Kk2[0][1] + Hk2[2][1]*Kk2[0][2];
SPk2[15] = Hk2[0][0]*Kk2[0][0] + Hk2[1][0]*Kk2[0][1] + Hk2[2][0]*Kk2[0][2];
float Pk2[4][4];
Pk2[0][0] = Pk1[0][0] - Pk1[0][0]*SPk2[15] - Pk1[1][0]*SPk2[14] - Pk1[2][0]*SPk2[13] - Pk1[3][0]*SPk2[12];
Pk2[0][1] = Pk1[0][1] - Pk1[0][1]*SPk2[15] - Pk1[1][1]*SPk2[14] - Pk1[2][1]*SPk2[13] - Pk1[3][1]*SPk2[12];
Pk2[0][2] = Pk1[0][2] - Pk1[0][2]*SPk2[15] - Pk1[1][2]*SPk2[14] - Pk1[2][2]*SPk2[13] - Pk1[3][2]*SPk2[12];
Pk2[0][3] = Pk1[0][3] - Pk1[0][3]*SPk2[15] - Pk1[1][3]*SPk2[14] - Pk1[2][3]*SPk2[13] - Pk1[3][3]*SPk2[12];
Pk2[1][0] = Pk1[1][0] - Pk1[0][0]*SPk2[11] - Pk1[1][0]*SPk2[10] - Pk1[2][0]*SPk2[9] - Pk1[3][0]*SPk2[8];
Pk2[1][1] = Pk1[1][1] - Pk1[0][1]*SPk2[11] - Pk1[1][1]*SPk2[10] - Pk1[2][1]*SPk2[9] - Pk1[3][1]*SPk2[8];
Pk2[1][2] = Pk1[1][2] - Pk1[0][2]*SPk2[11] - Pk1[1][2]*SPk2[10] - Pk1[2][2]*SPk2[9] - Pk1[3][2]*SPk2[8];
Pk2[1][3] = Pk1[1][3] - Pk1[0][3]*SPk2[11] - Pk1[1][3]*SPk2[10] - Pk1[2][3]*SPk2[9] - Pk1[3][3]*SPk2[8];
Pk2[2][0] = Pk1[2][0] - Pk1[0][0]*SPk2[7] - Pk1[1][0]*SPk2[6] - Pk1[2][0]*SPk2[5] - Pk1[3][0]*SPk2[4];
Pk2[2][1] = Pk1[2][1] - Pk1[0][1]*SPk2[7] - Pk1[1][1]*SPk2[6] - Pk1[2][1]*SPk2[5] - Pk1[3][1]*SPk2[4];
Pk2[2][2] = Pk1[2][2] - Pk1[0][2]*SPk2[7] - Pk1[1][2]*SPk2[6] - Pk1[2][2]*SPk2[5] - Pk1[3][2]*SPk2[4];
Pk2[2][3] = Pk1[2][3] - Pk1[0][3]*SPk2[7] - Pk1[1][3]*SPk2[6] - Pk1[2][3]*SPk2[5] - Pk1[3][3]*SPk2[4];
Pk2[3][0] = Pk1[3][0] - Pk1[0][0]*SPk2[3] - Pk1[1][0]*SPk2[2] - Pk1[2][0]*SPk2[1] - Pk1[3][0]*SPk2[0];
Pk2[3][1] = Pk1[3][1] - Pk1[0][1]*SPk2[3] - Pk1[1][1]*SPk2[2] - Pk1[2][1]*SPk2[1] - Pk1[3][1]*SPk2[0];
Pk2[3][2] = Pk1[3][2] - Pk1[0][2]*SPk2[3] - Pk1[1][2]*SPk2[2] - Pk1[2][2]*SPk2[1] - Pk1[3][2]*SPk2[0];
Pk2[3][3] = Pk1[3][3] - Pk1[0][3]*SPk2[3] - Pk1[1][3]*SPk2[2] - Pk1[2][3]*SPk2[1] - Pk1[3][3]*SPk2[0];
